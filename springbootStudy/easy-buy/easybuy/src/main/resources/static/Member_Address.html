<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link type="text/css" rel="stylesheet" href="css/style.css"/>
    <!--[if IE 6]>
    <script src="js/iepng.js" type="text/javascript"></script>
    <script type="text/javascript">
        EvPNG.fix('div, ul, img, li, input, a');
    </script>
    <![endif]-->
    <script src="vue/axios.min.js"></script>
    <script src="vue/axios.interceptor.js"></script>
    <script src="vue/vue.min.js"></script>
    <title>尤洪</title>
    <script src="vue/img.js"></script>
</head>
<body>
<!--Begin Header Begin-->
<div id="soubg">
    <div class="soubg">
        <div class="sou">
            <!--Begin 所在收货地区 Begin-->
            <span class="s_city_b">
        	<span class="fl">送货至：</span>
            <span class="s_city">
            	<span>四川</span>
                <div class="s_city_bg">
                	<div class="s_city_t"></div>
                    <div class="s_city_c">
                    	<h2>请选择所在的收货地区</h2>
                        <table border="0" class="c_tab" style="width:235px; margin-top:10px;" cellspacing="0"
                               cellpadding="0">
                          <tr>
                            <th>A</th>
                            <td class="c_h"><span>安徽</span><span>澳门</span></td>
                          </tr>
                          <tr>
                            <th>B</th>
                            <td class="c_h"><span>北京</span></td>
                          </tr>
                          <tr>
                            <th>C</th>
                            <td class="c_h"><span>重庆</span></td>
                          </tr>
                          <tr>
                            <th>F</th>
                            <td class="c_h"><span>福建</span></td>
                          </tr>
                          <tr>
                            <th>G</th>
                            <td class="c_h"><span>广东</span><span>广西</span><span>贵州</span><span>甘肃</span></td>
                          </tr>
                          <tr>
                            <th>H</th>
                            <td class="c_h"><span>河北</span><span>河南</span><span>黑龙江</span><span>海南</span><span>湖北</span><span>湖南</span></td>
                          </tr>
                          <tr>
                            <th>J</th>
                            <td class="c_h"><span>江苏</span><span>吉林</span><span>江西</span></td>
                          </tr>
                          <tr>
                            <th>L</th>
                            <td class="c_h"><span>辽宁</span></td>
                          </tr>
                          <tr>
                            <th>N</th>
                            <td class="c_h"><span>内蒙古</span><span>宁夏</span></td>
                          </tr>
                          <tr>
                            <th>Q</th>
                            <td class="c_h"><span>青海</span></td>
                          </tr>
                          <tr>
                            <th>S</th>
                            <td class="c_h"><span>上海</span><span>山东</span><span>山西</span><span
                                    class="c_check">四川</span><span>陕西</span></td>
                          </tr>
                          <tr>
                            <th>T</th>
                            <td class="c_h"><span>台湾</span><span>天津</span></td>
                          </tr>
                          <tr>
                            <th>X</th>
                            <td class="c_h"><span>西藏</span><span>香港</span><span>新疆</span></td>
                          </tr>
                          <tr>
                            <th>Y</th>
                            <td class="c_h"><span>云南</span></td>
                          </tr>
                          <tr>
                            <th>Z</th>
                            <td class="c_h"><span>浙江</span></td>
                          </tr>
                        </table>
                    </div>
                </div>
            </span>
        </span>
            <!--End 所在收货地区 End-->
            <span class="fr">
            <span class="fl">
                <span v-if="loginName===''">你好，请<a href="Login.html">登录</a>&nbsp;</span>
                <span v-else>欢迎:
                    <span style="font-size: 16px">{{loginName}}</span> &nbsp;
                    <a href="#" @click.prevent="exit">注销</a>&nbsp;
                </span>


                <a href="/api/Regist.html" style="color:#ff4e00;">免费注册</a>&nbsp;|&nbsp;
                <a href="/api/Member_Order.html">我的订单</a>&nbsp;|
            </span>

        	<span class="ss">
            	<div class="ss_list">
                	<a href="#">收藏夹</a>
                    <div class="ss_list_bg">
                    	<div class="s_city_t"></div>
                        <div class="ss_list_c">
                        	<ul>
                            	<li><a href="/api/Member_Collect.html">我的收藏</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="ss_list">
                	<a href="#">客户服务</a>
                    <div class="ss_list_bg">
                    	<div class="s_city_t"></div>
                        <div class="ss_list_c">
                        	<ul>
                            	<li><a href="/api/Member_Safe.html">账户安全</a></li>
                                <li><a href="/api/NewsList.html">资讯列表</a></li>
                                <li><a href="/api/Member_Order.html">后台服务</a>&nbsp;</li>
                                <li><a href="/api/Member_address.html">用户地址</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="ss_list">
                	<a href="#">购物</a>
                    <div class="ss_list_bg">
                    	<div class="s_city_t"></div>
                        <div class="ss_list_c">
                        	<ul>
                            	<li><a href="/api/CategoryList.html">全部商品</a></li>
                                <li><a href="/api/BuyCar.html">购物车</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </span>
            <span class="fl">|&nbsp;关注我们：</span>
            <span class="s_sh"><a href="#" class="sh1">新浪</a><a href="#" class="sh2">微信</a></span>
            <span class="fr">|&nbsp;<a href="#">手机版&nbsp;<img src="images/s_tel.png" align="absmiddle"/></a></span>
        </span>
        </div>
    </div>
    <div class="m_top_bg">
        <div class="top">
            <div class="m_logo"><a href="/api/Index.html"><img src="images/logo1.png"/></a></div>
            <div class="m_search">
                <form>
                    <input type="text" value="" class="m_ipt"/>
                    <input type="submit" value="搜索" class="m_btn"/>
                </form>
                <span class="fl"><a href="#">咖啡</a><a href="#">iphone 6S</a><a href="#">新鲜美食</a><a
                        href="#">蛋糕</a><a
                        href="#">日用品</a><a href="#">连衣裙</a></span>
            </div>
            <div class="i_car">
                <div class="car_t">购物车 [ <span>{{car.totalNum}}</span> ]</div>

                <div class="car_bg">

                    <!--Begin 购物车未登录 Begin-->
                    <div class="un_login" v-if="loginName==''||loginName==null">还未登录！<a href="/api/Login.html"
                                                                                            style="color:#ff4e00;">马上登录</a>
                        查看购物车！
                    </div>


                    <!--End 购物车未登录 End-->
                    <!--Begin 购物车已登录 Begin-->
                    <div v-else>
                        <ul class="cars">
                            <li v-for="carDetail in carDetailList">
                                <div class="img"><a href="#"><img
                                        :src="imgURL+carDetail.fileName" width="58"
                                        height="58"/></a></div>
                                <div class="name"><a href="#">{{carDetail.productName}}</a></div>
                                <div class="price"><font color="#ff4e00">{{carDetail.price}}</font> X{{carDetail.buyNum}}
                                </div>
                            </li>
                        </ul>
                        <div class="price_sum">共计&nbsp; <font color="#ff4e00">￥</font><span>{{car.totalPrice}}</span>
                        </div>
                        <div class="price_a"><a :href="'BuyCar.html?id='+car.id">去购物车结算</a></div>
                        <!--End 购物车已登录 End-->
                    </div>
                </div>
            </div>
        </div>
        <!--End Header End-->
        <div class="i_bg bg_color">
            <!--Begin 用户中心 Begin -->
            <div class="m_content">
                <div class="m_left" id="mySlide">
                    <!--            用户管理、资讯添加、商品管理、分类管理要进行权限判断、-->

                    <div class="left_n"></div>
                    <div class="left_m">
                        <div class="left_m_t t_bg1">订单中心</div>
                        <ul>
                            <li><a href="/api/Member_Order.html">订单管理</a></li>
                            <li><a href="/api/Member_Address.html" style="color: #ff3600">收货地址</a></li>
                        </ul>
                    </div>
                    <div class="left_m">
                        <div class="left_m_t t_bg3">账户中心</div>
                        <ul>
                            <li><a href="/api/Member_Safe.html">账户安全</a></li>
                            <li><a href="/api/Member_Collect.html">我的收藏</a></li>
                        </ul>
                    </div>
                    <div class="left_m" v-if="userType==1">
                        <div class="left_m_t t_bg4">用户管理</div>
                        <ul>
                            <li><a href="/api/UserManager.html">用户列表</a></li>
                        </ul>
                    </div>
                    <div class="left_m">
                        <div class="left_m_t t_bg4">资讯管理</div>
                        <ul>
                            <li><a href="/api/NewsList.html">资讯列表</a></li>
                            <li><a href="/api/NewsAdd.html" v-show="userType==1">资讯添加</a></li>
                        </ul>
                    </div>
                    <div class="left_m" v-show="userType==1">
                        <div class="left_m_t t_bg4">商品管理</div>
                        <ul>
                            <li><a href="/api/ProductList.html">商品列表</a></li>
                            <li><a href="/api/ProductAdd.html">商品添加</a></li>
                        </ul>
                    </div>
                    <div class="left_m" v-show="userType==1">
                        <div class="left_m_t t_bg4">分类管理</div>
                        <ul>
                            <li><a href="/api/ProductCategory.html">分类列表</a></li>
                        </ul>
                    </div>
                </div>

                <div class="m_right" id="myAddress">
                    <p></p>
                    <div class="mem_tit">收货地址</div>

                    <div v-if="addressList.length==0">
                        <h2 style="text-align: center">暂无数据</h2>
                    </div>

                    <div class="address" v-for="addressKey in addressList"
                         style="width: 300px;float: left; margin-right: 50px; margin-left: 50px"
                         :style="{backgroundColor:addressKey.isDefault==1 ? '#77DDFF' : ''}"

                    >
                        <!--------删除的按钮------------->
                        <div class="a_close"><a href="#" @click.prevent="deleteAddress(addressKey.id)"><img
                                src="images/a_close.png"/></a></div>
                        <table border="0" class="add_t" align="center" style="width:98%; margin:10px auto;"
                               cellspacing="0"
                               cellpadding="0">
                            <tr>
                                <td colspan="2" style="font-size:14px; color:#ff4e00;">
                                    {{addressKey.remark}}
                                </td>
                            </tr>

                            <tr>
                                <td align="right" width="80">收货人姓名：</td>
                                <td>{{addressKey.name}}</td>
                            </tr>

                            <tr>
                                <td align="right">配送区域：</td>
                                <td>{{addressKey.province}}省{{addressKey.city}}市{{addressKey.area}}区</td>
                            </tr>
                            <tr>
                                <td align="right">详细地址：</td>
                                <td>{{addressKey.address}}</td>
                            </tr>
                            <tr>
                                <td align="right">手机：</td>
                                <td>
                                    {{addressKey.phone}}
                                </td>
                            </tr>

                            <tr>
                                <td align="right">电子邮箱：</td>
                                <td>
                                    {{addressKey.email}}
                                </td>
                            </tr>

                        </table>

                        <p align="right">
                            <a href="#" style="color:#ff4e00;" @click.prevent="setIsDefault(addressKey.id)">设为默认</a>&nbsp;
                            &nbsp; &nbsp; &nbsp; <a
                                href="#" style="color:#ff4e00; " @click.prevent="findAddress(addressKey.id)">编辑</a>&nbsp;
                            &nbsp; &nbsp; &nbsp;
                        </p>

                    </div>

                    <!--------增加地址按钮------------->
                    <div class="mem_tit">
                        <a href="#" @click.prevent="isShowAdd"><img src="images/add_ad.gif"/></a>
                    </div>


                    <!--------增加地址列表------------->
                    <div v-show="booleanShowAdd">
                        <table border="0" class="add_tab" style="width:930px;" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="135" align="right">配送地区</td>
                                <td colspan="3" style="font-family:'宋体';">
                                    省(直辖市): <select class="jj" v-model="selectProvince"
                                                        style="background-color:#f6f6f6;"
                                                        @change="provinceChange">
                                    <option value="-1">请选择...</option>
                                    <option v-for="province in provinces" :value="province.name">{{province.name}}
                                    </option>
                                </select>


                                    市: <select class="jj" v-model="selectCity" style="background-color:#f6f6f6;"
                                                @change="cityChange">
                                    <option value="-1">请选择...</option>
                                    <option v-for="city in cities" v-if="selectProvince==city.parentName"
                                            :value="city.name">
                                        {{city.name}}
                                    </option>
                                </select>

                                    区: <select class="jj" v-model="selectArea" style="background-color:#f6f6f6;">
                                    <option value="-1">请选择...</option>
                                    <option v-for="area in areas" v-if="selectCity==area.parentName" :value="area.name">
                                        {{area.name}}
                                    </option>
                                </select>
                                    （必填）
                                </td>
                            </tr>
                            <tr>
                                <td align="right">收货人姓名</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="name" class="add_ipt"/>（必填）
                                </td>

                                <td align="right">详细地址</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="address" class="add_ipt"/>（必填）
                                </td>
                            </tr>

                            <tr>
                                <td align="right">手机</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="phone" class="add_ipt"/>（必填）
                                </td>

                                <td align="right">电子邮箱</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="email" class="add_ipt"/>（必填）
                                </td>

                            </tr>

                            <tr>

                                <td align="right">标记为</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="remark" class="add_ipt"/>
                                    （必填）
                                </td>

                                <td align="right">是否设为默认地址</td>
                                <td><select v-model="isDefault">
                                    <option value="-1">--请选择--</option>
                                    <option value="0">否</option>
                                    <option value="1">是</option>
                                </select>
                                    （必填）
                                </td>
                            </tr>
                        </table>
                        <p align="right">
                            &nbsp; &nbsp; <a href="#" class="add_b" @click.prevent="addAddress">确认添加</a>
                        </p>
                    </div>

                    <!--------修改地址列表------------->
                    <div v-show="booleanShowUpdate">
                        <table border="0" class="add_tab" style="width:930px;" cellspacing="0" cellpadding="0">
                            <tr>
                                <td width="135" align="right">配送地区</td>
                                <td colspan="3" style="font-family:'宋体';">
                                    省(直辖市): <select class="jj" v-model="selectProvince"
                                                        style="background-color:#f6f6f6;"
                                                        @change="provinceChange">
                                    <option value="-1">请选择...</option>
                                    <option v-for="province in provinces" :value="province.name">{{province.name}}
                                    </option>
                                </select>


                                    市: <select class="jj" v-model="selectCity" style="background-color:#f6f6f6;"
                                                @change="cityChange">

                                    <option value="-1">请选择...</option>
                                    <option v-for="city in cities" v-if="selectProvince==city.parentName"
                                            :value="city.name">
                                        {{city.name}}
                                    </option>
                                </select>

                                    区: <select class="jj" v-model="selectArea" style="background-color:#f6f6f6;">
                                    <option value="-1">请选择...</option>
                                    <option v-for="area in areas" v-if="selectCity==area.parentName" :value="area.name">
                                        {{area.name}}
                                    </option>
                                </select>
                                    （必填）
                                </td>
                            </tr>
                            <tr>
                                <td align="right">收货人姓名</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="name" class="add_ipt"/>（必填）
                                </td>

                                <td align="right">详细地址</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="address" class="add_ipt"/>（必填）
                                </td>
                            </tr>

                            <tr>
                                <td align="right">手机</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="phone" class="add_ipt"/>（必填）
                                </td>

                                <td align="right">电子邮箱</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="email" class="add_ipt"/>（必填）
                                </td>

                            </tr>

                            <tr>

                                <td align="right">标记为</td>
                                <td style="font-family:'宋体';"><input type="text" v-model="remark" class="add_ipt"/>
                                    （必填）
                                </td>

                                <td align="right">是否设为默认地址</td>
                                <td><select v-model="isDefault">
                                    <option value="-1">--请选择--</option>
                                    <option value="0">否</option>
                                    <option value="1">是</option>
                                </select>
                                    （必填）
                                </td>
                            </tr>
                        </table>
                        <p align="right">
                            &nbsp; &nbsp; <a href="#" class="add_b" @click.prevent="updateAddress">确认修改</a>
                        </p>
                    </div>
                </div>
            </div>
            <!--End 用户中心 End-->
            <!--Begin Footer Begin -->
            <div class="b_btm_bg b_btm_c">
                <div class="b_btm">
                    <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;"
                           cellspacing="0" cellpadding="0">
                        <tr>
                            <td width="72"><img src="images/b1.png" width="62" height="62"/></td>
                            <td><h2>正品保障</h2>正品行货 放心购买</td>
                        </tr>
                    </table>
                    <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;"
                           cellspacing="0" cellpadding="0">
                        <tr>
                            <td width="72"><img src="images/b2.png" width="62" height="62"/></td>
                            <td><h2>满38包邮</h2>满38包邮 免运费</td>
                        </tr>
                    </table>
                    <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;"
                           cellspacing="0" cellpadding="0">
                        <tr>
                            <td width="72"><img src="images/b3.png" width="62" height="62"/></td>
                            <td><h2>天天低价</h2>天天低价 畅选无忧</td>
                        </tr>
                    </table>
                    <table border="0" style="width:210px; height:62px; float:left; margin-left:75px; margin-top:30px;"
                           cellspacing="0" cellpadding="0">
                        <tr>
                            <td width="72"><img src="images/b4.png" width="62" height="62"/></td>
                            <td><h2>准时送达</h2>收货时间由你做主</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="b_nav">
                <dl>
                    <dt><a href="#">新手上路</a></dt>
                    <dd><a href="#">售后流程</a></dd>
                    <dd><a href="#">购物流程</a></dd>
                    <dd><a href="#">订购方式</a></dd>
                    <dd><a href="#">隐私声明</a></dd>
                    <dd><a href="#">推荐分享说明</a></dd>
                </dl>
                <dl>
                    <dt><a href="#">配送与支付</a></dt>
                    <dd><a href="#">货到付款区域</a></dd>
                    <dd><a href="#">配送支付查询</a></dd>
                    <dd><a href="#">支付方式说明</a></dd>
                </dl>
                <dl>
                    <dt><a href="#">会员中心</a></dt>
                    <dd><a href="#">资金管理</a></dd>
                    <dd><a href="#">我的收藏</a></dd>
                    <dd><a href="#">我的订单</a></dd>
                </dl>
                <dl>
                    <dt><a href="#">服务保证</a></dt>
                    <dd><a href="#">退换货原则</a></dd>
                    <dd><a href="#">售后服务保证</a></dd>
                    <dd><a href="#">产品质量保证</a></dd>
                </dl>
                <dl>
                    <dt><a href="#">联系我们</a></dt>
                    <dd><a href="#">网站故障报告</a></dd>
                    <dd><a href="#">购物咨询</a></dd>
                    <dd><a href="#">投诉与建议</a></dd>
                </dl>
                <div class="b_tel_bg">
                    <a href="#" class="b_sh1">新浪微博</a>
                    <a href="#" class="b_sh2">腾讯微博</a>
                    <p>
                        服务热线：<br/>
                        <span>400-123-4567</span>
                    </p>
                </div>
                <div class="b_er">
                    <div class="b_er_c"><img src="images/er.gif" width="118" height="118"/></div>
                    <img src="images/ss.png"/>
                </div>
            </div>
            <div class="btmbg">
                <div class="btm">
                    备案/许可证编号：蜀ICP备12009302号-1-www.dingguagua.com Copyright © 2015-2018 尤洪商城网 All Rights
                    Reserved.
                    复制必究 , Technical Support: Dgg Group <br/>
                    <img src="images/b_1.gif" width="98" height="33"/><img src="images/b_2.gif" width="98" height="33"/><img
                        src="images/b_3.gif" width="98" height="33"/><img src="images/b_4.gif" width="98"
                                                                          height="33"/><img
                        src="images/b_5.gif" width="98" height="33"/><img src="images/b_6.gif" width="98" height="33"/>
                </div>
            </div>
            <!--End Footer End -->
        </div>

    </div>
</div>
</body>

<script>
    let vm = new Vue({

        el: "#soubg",

        data: {

            //增加地址
            provinces: "",
            cities: "",
            areas: "",

            selectProvince: -1,
            selectCity: -1,
            selectArea: -1,

            booleanShowAdd: false,

            id: "",
            userId: "",
            name: "",
            address: "",
            phone: "",
            email: "",
            remark: "",
            isDefault: -1,

            //遍历地址
            addressList: "",


            //修改地址
            booleanShowUpdate: false,

            UserAddress: "",

            userType: "",

            loginName: "",

            car: "",

            carDetailList: "",
        },

        methods: {

            exit: function () {
                if (confirm("你确定要注销吗?")) {
                    axios({
                        url: "/api/loginOut",
                    }).then(rs => {
                        if (rs.data.msg == "true") {
                            alert("注销成功");
                            window.sessionStorage.clear();
                            window.location.href = "/api/login.html";
                        }
                    })
                }
            },

            getCar() {
                axios({
                    url: "/api/car/getCar",
                }).then(rs => {
                    this.car = rs.data.car;

                    //定义一个专门存放 购物车的数组 把返回的集合遍历,集合元素放入数组
                    let array = [];

                    for (let car in rs.data.carMap) {
                        array.push(rs.data.carMap[car]);
                    }

                    this.carDetailList = array;
                })
            },

            //设置默认
            setIsDefault(id) {
                let result = confirm("你确定要设置为默认吗?");

                if (result == false) {
                    return;
                }
                axios({
                    url: "/api/address/setIsDefault",
                    params: {
                        userId: this.userId,
                        id,
                    }
                }).then(rs => {
                    if (rs.data.isSet != null) {
                        alert("设置默认成功");
                        this.selectAddressList();
                    } else {
                        alert("设置默认失败");
                    }
                })
            },


            //删除地址
            deleteAddress(id) {
                let result = confirm("你确定要删除吗?");

                if (result == false) {
                    return;
                }
                axios({
                    url: "/api/address/deleteAddress",
                    params: {
                        id
                    }
                }).then(rs => {
                    if (rs.data.isDelete == true) {
                        alert("删除成功");
                        this.selectAddressList();
                    } else {
                        alert("删除失败");
                    }
                })
            },


            //修改地址
            updateAddress() {
                let id = this.id;
                let userId = this.userId;
                let name = this.name;

                let province = this.selectProvince;
                let city = this.selectCity;
                let area = this.selectArea;
                let address = this.address;

                let phone = this.phone;
                let email = this.email;
                let remark = this.remark;
                let isDefault = this.isDefault;

                if (name == "" || province == -1 || city == -1 || area == -1 || address == "" || phone == "" || email == "" || remark == "" || isDefault == -1) {
                    alert("请将字段填写完整再提交");
                    return;
                }

                if (!(email.substring(email.length - 4, email.length) === ".com" && email.lastIndexOf("@") !== -1 && email.lastIndexOf("@") < email.lastIndexOf(".com"))) {
                    alert("邮箱格式错误！")
                    return;
                }

                if (!/^1[3|4|5|7|8|9][0-9]{9}$/.test(phone)) {
                    alert("手机号格式有误！");
                    return;
                }

                axios({
                    url: "/api/address/updateAddress",
                    params: {
                        id, userId, name, province, city, area, address, phone, email, remark, isDefault
                    },
                }).then(rs => {
                    if (rs.data.isUpdate == true) {
                        alert("修改成功");
                        //修改成功关闭表单
                        this.booleanShowUpdate = false;

                        //刷新页面
                        this.selectAddressList();

                    } else {
                        alert("修改失败");
                    }
                })
            },


            //查询修改地址状态
            findAddress(id) {

                //关闭添加表单,打开修改表单
                this.booleanShowAdd = false;
                this.booleanShowUpdate = true;

                axios({
                    url: "/api/address/findAddress",
                    params: {
                        id
                    },
                }).then(rs => {
                    this.UserAddress = rs.data.UserAddress;
                    this.id = this.UserAddress.id;
                    this.selectProvince = this.UserAddress.province;
                    this.selectCity = this.UserAddress.city;
                    this.selectArea = this.UserAddress.area;
                    this.name = this.UserAddress.name;
                    this.address = this.UserAddress.address;
                    this.phone = this.UserAddress.phone;
                    this.email = this.UserAddress.email;
                    this.remark = this.UserAddress.remark;
                    this.isDefault = this.UserAddress.isDefault;
                })
            },


            //查询所有地址
            selectAddressList() {
                axios({
                    url: "/api/address/selectAddressList",
                    params: {
                        userId: this.userId,
                    },
                }).then(rs => {
                    this.addressList = rs.data.addressList;
                    console.log(rs.data);
                })
            },

            //增加地址
            addAddress() {
                let userId = this.userId;
                let name = this.name;

                let province = this.selectProvince;
                let city = this.selectCity;
                let area = this.selectArea;
                let address = this.address;

                let phone = this.phone;
                let email = this.email;
                let remark = this.remark;
                let isDefault = this.isDefault;

                if (name == "" || province == -1 || city == -1 || area == -1 || address == "" || phone == "" || email == "" || remark == "" || isDefault == -1) {
                    alert("请将字段填写完整再提交");
                    return;
                }

                if (!(email.substring(email.length - 4, email.length) === ".com" && email.lastIndexOf("@") !== -1 && email.lastIndexOf("@") < email.lastIndexOf(".com"))) {
                    alert("邮箱格式错误！")
                    return;
                }

                if (!/^1[3|4|5|7|8|9][0-9]{9}$/.test(phone)) {
                    alert("手机号格式有误！");
                    return;
                }

                axios({
                    url: "/api/address/addAddress",
                    params: {
                        userId, name, province, city, area, address, phone, email, remark, isDefault
                    },
                }).then(rs => {
                    if (rs.data.isAdd == true) {
                        console.log(rs.data.isAdd);
                        alert("添加成功");

                        //添加成功关闭表单
                        this.booleanShowAdd = false;

                        //刷新页面
                        this.selectAddressList();
                    } else {
                        alert("添加失败");
                    }
                })
            },


            isShowAdd() {
                //判断列表长度
                if (this.addressList.length >= 4) {
                    alert("添加地址数量最多为4个");
                    return;
                }

                //打开添加表单,关闭修改表单
                this.booleanShowAdd = true;
                this.booleanShowUpdate = false;

                //清空表单数据
                this.name = "";
                this.selectProvince = -1;
                this.selectCity = -1;
                this.selectArea = -1;
                this.address = "";
                this.phone = "";
                this.email = "";
                this.remark = "";
                this.isDefault = "";
            },

            provinceChange() {
                this.selectCity = -1;
                this.selectArea = -1;
            },

            cityChange() {
                this.selectArea = -1;
            },

            //初始化获得地区的名字
            doInit() {
                axios({
                    url: "/api/area_format_object.json"
                }).then(rs => {
                    let data = rs.data;
                    let provinces = [];
                    let cities = [];
                    let areas = [];
                    for (let province in data) {
                        //存储省份名字
                        provinces.push({"name": data[province].n});

                        for (let city in data[province].c) {
                            //存储城市名字
                            cities.push({"name": data[province].c[city].n, "parentName": data[province].n});

                            for (let area in data[province].c[city].c) {
                                //存储地区名字
                                areas.push({
                                    "name": data[province].c[city].c[area].n,
                                    "parentName": data[province].c[city].n
                                })
                            }
                        }
                    }

                    this.provinces = provinces;
                    this.cities = cities;
                    this.areas = areas;
                })
            }
        },

        created: function () {

            let token = window.sessionStorage.getItem("token");
            if (token == null || token == "") {
                return;
            }

            axios({
                url: "/api/user/findUserFromToken"
            }).then(rs => {
                this.userId = rs.data.user.id;
                this.userType = rs.data.user.type;
                this.loginName = rs.data.user.loginName;
                this.doInit();
                this.getCar();
                this.selectAddressList();
            })
        }
    })


</script>

</html>
